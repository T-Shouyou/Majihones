<!doctype html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>投稿フォーム</title>
    <style>
        .error-message {
            color: red;
            display: none;
            /* 初期状態で非表示 */
            margin-left: 10px;
        }
    </style>
    <script>
        function validateForm(event) {
            const textArea = document.querySelector('textarea[name="sentence"]');
            const imageUpload = document.getElementById('imageUpload');
            const imageErrorMessage = document.getElementById('imageErrorMessage');

            // 初期状態でエラーメッセージを非表示
            imageErrorMessage.style.display = 'none';

            let valid = true;

            // テキストエリアが空の場合
            if (textArea.value.trim() === '') {
                textArea.placeholder = '未入力のままでは投稿ができません、この欄にテキストを入力してください';
                valid = false;
            } else {
                textArea.placeholder = 'テキストを入力';
            }

            // 画像が選択されていない場合
            if (imageUpload.files.length === 0) {
                imageErrorMessage.style.display = 'inline';
                valid = false;
            } else {
                imageErrorMessage.style.display = 'none';
            }

            // 無効な場合、フォームの送信をキャンセル
            if (!valid) {
                event.preventDefault();
            }
        }

        window.onload = function () {
            // フォームの送信時にバリデーションを実行
            document.getElementById('postForm').addEventListener('submit', validateForm);
        };
    </script>
</head>

<body>
    <header>
        <h1>投稿フォーム</h1>
    </header>
    <form id="postForm" action="{{ url_for('save_gohan_post') }}" method="post" enctype="multipart/form-data">
        <textarea name="sentence" placeholder="テキストを入力" rows="4" style="width:100%;"></textarea>
        <input type="file" name="photo" id="imageUpload" accept="image/*">
        <span id="imageErrorMessage" class="error-message">画像が未選択です</span>
        <img id="imagePreview" class="image-preview" style="display:none;" alt="Image preview">
        <button type="submit">投稿</button>
    </form>
    <button onclick="location.href='{{ url_for('area_gohan') }}';">戻る</button>
</body>

</html>